{"version":3,"file":"peppermint-router.cjs.js","sources":["../src/utils/utils.ts","../src/utils/waitHandle.ts","../src/components/RouterContext.tsx","../src/components/PromptNavigation.tsx","../src/components/Route.tsx","../src/components/RouteFallback.tsx","../src/logic/hashRouter.ts","../src/components/RouterView.tsx"],"sourcesContent":["export function removeStart(str: string, ...toRemove: string[]): string {\r\n    return removeSide(\r\n        str,\r\n        /^(\\s*[\\r\\n]*)*/,\r\n        String.prototype.startsWith,\r\n        (s, tr) => s.substring(tr.length),\r\n        ...toRemove\r\n    );\r\n}\r\n\r\nexport function removeEnd(str: string, ...toRemove: string[]): string {\r\n    return removeSide(\r\n        str,\r\n        /(\\s*[\\r\\n]*)*$/,\r\n        String.prototype.endsWith,\r\n        (s, tr) => s.substring(0, s.length - tr.length),\r\n        ...toRemove\r\n    );\r\n}\r\n\r\nfunction removeSide(\r\n    str: string,\r\n    whitespaceReplacePattern: RegExp,\r\n    shouldRemove: (trimStr: string) => boolean,\r\n    remove: (str: string, trimStr: string) => string,\r\n    ...toRemove: string[]\r\n): string {\r\n\r\n    // input validation\r\n    if (typeof str !== \"string\") {\r\n        throw new Error(`Missing arguement '${nameof(str)}'.`);\r\n    }\r\n    if (!toRemove.every(tr => typeof tr === 'string')) {\r\n        throw new Error(`Invalid argument '${toRemove}'. Only strings expected.`);\r\n    }\r\n\r\n    // default behavior: trim white spaces\r\n    if (!toRemove.length) {\r\n        return str.replace(whitespaceReplacePattern, \"\");\r\n    }\r\n\r\n    // trim specified patterns\r\n    let result = str.substring(0);\r\n    let keepRunning = true;\r\n    while (result.length && keepRunning) {\r\n        keepRunning = false;\r\n        for (const trimStr of toRemove) {\r\n            if (!shouldRemove.call(result, trimStr))\r\n                continue;\r\n            result = remove(result, trimStr);\r\n            keepRunning = true;\r\n        }\r\n    }\r\n\r\n    return result;\r\n}","export class WaitHandle<T = void> {\r\n\r\n    private _resolve: (result?: T | PromiseLike<T>) => void;\r\n    private _reject: (err?: Error) => void;\r\n    private readonly promise: Promise<T>;\r\n\r\n    constructor() {\r\n        this.promise = new Promise((resolve, reject) => {\r\n            this._resolve = resolve;\r\n            this._reject = reject;\r\n        });\r\n    }\r\n\r\n    public wait(): Promise<T> {\r\n        return this.promise;\r\n    }\r\n\r\n    public resolve(result?: T | PromiseLike<T>): void {\r\n        this._resolve(result);\r\n    }\r\n\r\n    public reject(err?: Error): void {\r\n        this._reject(err);\r\n    }\r\n}","import * as React from 'react';\r\nimport { HashRouter, RouteInfo } from '../logic';\r\n\r\nexport interface RouterContextValue {\r\n    router: HashRouter;\r\n    currentRoute: RouteInfo;\r\n    setCurrentRoute: (route: RouteInfo) => void;\r\n}\r\n\r\nexport const RouterContext = React.createContext<RouterContextValue>(undefined);","import * as React from 'react';\r\nimport { WaitHandle } from '../utils';\r\nimport { RouterContext } from './RouterContext';\r\n\r\nexport interface PromptNavigationRenderProps {\r\n    isNavigating: boolean;\r\n    confirm: VoidFunction;\r\n    cancel: VoidFunction;\r\n}\r\n\r\nexport type PromptNavigationRender = (props: PromptNavigationRenderProps) => React.ReactNode;\r\n\r\nexport interface PromptNavigationProps {\r\n    enabled?: boolean;\r\n    exitPrompt?: string;\r\n    children?: PromptNavigationRender;\r\n}\r\n\r\ninterface PromptNavigationState {\r\n    isNavigating: boolean;\r\n    confirmNavigation?: WaitHandle;\r\n}\r\n\r\nexport function PromptNavigation(props: PromptNavigationProps) {\r\n\r\n    const context = React.useContext(RouterContext);\r\n    const [state, setState] = React.useState<PromptNavigationState>({ isNavigating: false });\r\n\r\n    React.useEffect(() => {\r\n\r\n        // in-app navigation handler\r\n        if (props.enabled && props.children) {\r\n            context.router.onBeforeNavigation = async () => {\r\n                const confirmNavigation = new WaitHandle();\r\n                setState({\r\n                    isNavigating: true,\r\n                    confirmNavigation\r\n                });\r\n                let confirmed = true;\r\n                await confirmNavigation.wait().catch(() => confirmed = false);\r\n                return confirmed;\r\n            };\r\n        }\r\n\r\n        // out-of-app navigation handler\r\n        if (props.enabled && props.exitPrompt) {\r\n            context.router.onBeforeUnload = () => props.exitPrompt;\r\n        }\r\n\r\n        // dispose\r\n        return () => {\r\n            context.router.onBeforeNavigation = null;\r\n            context.router.onBeforeUnload = null;\r\n        };\r\n    });\r\n\r\n    const clearState = () => setState({\r\n        isNavigating: false,\r\n        confirmNavigation: null\r\n    });\r\n\r\n    // render\r\n    if (props.enabled && props.children) {\r\n        return props.children({\r\n            isNavigating: state.isNavigating,\r\n            confirm: () => {\r\n                const confirm = state.confirmNavigation;\r\n                clearState();\r\n                confirm && confirm.resolve();\r\n            },\r\n            cancel: () => {\r\n                const confirm = state.confirmNavigation;\r\n                clearState();\r\n                confirm && confirm.reject();\r\n            }\r\n        });\r\n    }\r\n\r\n    return null;\r\n};","import * as React from 'react';\r\nimport { RouteParams } from '../logic';\r\nimport { RouterContext, RouterContextValue } from './RouterContext';\r\n\r\nexport interface RouteProps {\r\n    path: string;\r\n    component: React.ComponentType<any>;\r\n}\r\n\r\nexport class Route extends React.Component<RouteProps> {\r\n\r\n    public render() {\r\n        return (\r\n            <RouterContext.Consumer>\r\n                {this.renderRoute}\r\n            </RouterContext.Consumer>\r\n        );\r\n    }\r\n\r\n    private renderRoute = (context: RouterContextValue) => {\r\n\r\n        this.registerRoute(context);\r\n\r\n        if (this.props.path !== context.currentRoute.path)\r\n            return null;\r\n\r\n        return (\r\n            React.createElement(\r\n                this.props.component,\r\n                {\r\n                    route: context.currentRoute\r\n                }\r\n            )\r\n        );\r\n    };\r\n\r\n    private registerRoute(context: RouterContextValue) {\r\n        context.router.mapPath(this.props.path, (params: RouteParams) => {\r\n            context.setCurrentRoute({\r\n                path: this.props.path,\r\n                params\r\n            });\r\n        });\r\n    }\r\n}","import * as React from 'react';\r\nimport { RouterContext, RouterContextValue } from './RouterContext';\r\n\r\nexport interface RouteFallbackProps {\r\n    component: React.ComponentType<any>;\r\n}\r\n\r\nexport class RouteFallback extends React.Component<RouteFallbackProps> {\r\n\r\n    public render() {\r\n        return (\r\n            <RouterContext.Consumer>\r\n                {this.renderRoute}\r\n            </RouterContext.Consumer>\r\n        );\r\n    }\r\n\r\n    private renderRoute = (context: RouterContextValue) => {\r\n\r\n        this.registerRoute(context);\r\n\r\n        if (context.currentRoute.path !== null)\r\n            return null;\r\n\r\n        return (\r\n            React.createElement(\r\n                this.props.component,\r\n                {\r\n                    route: context.currentRoute\r\n                }\r\n            )\r\n        );\r\n    };\r\n\r\n    private registerRoute(context: RouterContextValue) {\r\n        context.router.fallback = () => context.setCurrentRoute({\r\n            path: null,\r\n            params: null\r\n        });\r\n    }\r\n}","import { IMap, removeEnd, removeStart } from '../utils';\r\n\r\n// originally based on PathJS: https://github.com/mtrpcic/pathjs\r\n\r\nexport type RouteParams = IMap<string>;\r\n\r\nexport interface RouteInfo {\r\n    path: string;\r\n    params: RouteParams;\r\n}\r\n\r\nexport interface BeforeNavigationEvent {\r\n    prevRoute: RouteInfo;\r\n    nextRoute: RouteInfo;\r\n}\r\n\r\nexport type BeforeNavigationHandler = (e: BeforeNavigationEvent) => Promise<boolean>;\r\n\r\nexport interface BeforeUnloadEvent {\r\n    currentRoute: RouteInfo;\r\n}\r\n\r\nexport type BeforeUnloadHandler = (e: BeforeUnloadEvent) => string;\r\n\r\nexport type RouteAction = (params: RouteParams) => void;\r\n\r\ninterface RouteConfig {\r\n    path: string;\r\n    action: RouteAction;\r\n}\r\n\r\ninterface RouteConfigMatchResult {\r\n    route: RouteConfig;\r\n    params: RouteParams;\r\n}\r\n\r\nexport class HashRouter {\r\n\r\n    //\r\n    // public members\r\n    //\r\n\r\n    public fallback: VoidFunction;\r\n    /**\r\n     * Triggered when a navigation inside the application takes place.  \r\n     * Return `false` to cancel navigation.\r\n     */\r\n    public get onBeforeNavigation(): BeforeNavigationHandler {\r\n        return this._onBeforeNavigation;\r\n    }\r\n    public set onBeforeNavigation(value: BeforeNavigationHandler) {\r\n\r\n        // prevent accidental overwrites\r\n        if (value && this._onBeforeNavigation) {\r\n            throw new Error(\r\n                `${nameof(this.onBeforeNavigation)} handler already exists. Remove the old one before assigning a new handler.`\r\n            );\r\n        }\r\n\r\n        this._onBeforeNavigation = value;\r\n    }\r\n    /**\r\n     * Triggered when a navigation to another site takes place.\r\n     * Return a message to show to the user.  \r\n     */\r\n    public get onBeforeUnload(): BeforeUnloadHandler {\r\n        return this._onBeforeUnload;\r\n    }\r\n    public set onBeforeUnload(value: BeforeUnloadHandler) {\r\n\r\n        // prevent accidental overwrites\r\n        if (value && this._onBeforeUnload) {\r\n            throw new Error(\r\n                `${nameof(this.onBeforeUnload)} handler already exists. Remove the old one before assigning a new handler.`\r\n            );\r\n        }\r\n\r\n        this._onBeforeUnload = value;\r\n    }\r\n    public get currentRoute(): RouteInfo {\r\n        return this._currentRoute;\r\n    }\r\n\r\n    //\r\n    // private members\r\n    //\r\n\r\n    private _onBeforeNavigation: BeforeNavigationHandler;\r\n    private _onBeforeUnload: BeforeUnloadHandler;\r\n    private _currentRoute: RouteInfo = ({} as RouteInfo);\r\n    private readonly routes: IMap<RouteConfig> = {};\r\n\r\n    //\r\n    // public methods\r\n    //\r\n\r\n    public mapPath(path: string, action: RouteAction) {\r\n        path = this.normalizePath(path);\r\n        this.routes[path] = { path, action };\r\n    }\r\n\r\n    public goTo(path: string) {\r\n        path = this.normalizePath(path);\r\n        location.hash = '#/' + path;\r\n    }\r\n\r\n    public goBack() {\r\n        window.history.back();\r\n    }\r\n\r\n    public listen() {\r\n\r\n        // register unload handler\r\n        window.addEventListener('beforeunload', e => {\r\n            const promptMessage = (this.onBeforeUnload ?\r\n                this.onBeforeUnload({\r\n                    currentRoute: this.currentRoute\r\n                }) :\r\n                undefined\r\n            );\r\n            if (promptMessage) {\r\n                e.returnValue = promptMessage;\r\n            }\r\n            return promptMessage;\r\n        });\r\n\r\n        // listen to hash changes\r\n        window.addEventListener('hashchange', this.handleHashChanged);\r\n\r\n        // handle initial route\r\n        if (location.hash === '') {\r\n            location.hash = '#/';\r\n\r\n        } else {\r\n            this.handleHashChanged();\r\n        }\r\n    }\r\n\r\n    //\r\n    // private methods\r\n    //\r\n\r\n    private handleHashChanged = async (): Promise<void> => {\r\n        let path = location.hash;\r\n\r\n        // normalize path\r\n        path = this.normalizePath(path);\r\n\r\n        // don't re-navigate to the same page\r\n        if (path === this._currentRoute.path)\r\n            return;\r\n\r\n        // find the route to active\r\n        const matchResult = this.match(path);\r\n        const nextRoute: RouteInfo = {\r\n            path,\r\n            params: (matchResult && matchResult.params) || {}\r\n        };\r\n\r\n        // invoke beforeNavigation handler\r\n        if (this.onBeforeNavigation) {\r\n            const continueNavigation = await this.onBeforeNavigation({\r\n                prevRoute: this.currentRoute,\r\n                nextRoute\r\n            });\r\n            if (continueNavigation === false) {\r\n\r\n                // restore location hash\r\n                this.goTo(this._currentRoute.path);\r\n                return;\r\n            }\r\n        }\r\n\r\n        // activate route\r\n        this._currentRoute = nextRoute;\r\n        if (matchResult) {\r\n            matchResult.route.action(matchResult.params);\r\n            return;\r\n        }\r\n\r\n        // route fallback\r\n        if (this.fallback) {\r\n            this.fallback();\r\n        }\r\n    };\r\n\r\n    private match(pathToMatch: string): RouteConfigMatchResult {\r\n\r\n        for (const routePath of Object.keys(this.routes)) {\r\n\r\n            const route = this.routes[routePath];\r\n\r\n            // handle route parameters\r\n            const params: IMap<string> = {};\r\n            const routeToMatchParts = pathToMatch.split('/');\r\n            if (routePath.search(/:/) > 0) {\r\n\r\n                const routeParts = routePath.split('/');\r\n\r\n                for (let i = 0; i < routeParts.length; i++) {\r\n\r\n                    // skip non-param parts\r\n                    const paramPart = routeParts[i];\r\n                    if (!paramPart || paramPart[0] !== ':')\r\n                        continue;\r\n\r\n                    // stop if done processing\r\n                    if (i >= routeToMatchParts.length)\r\n                        break;\r\n\r\n                    // store the parameter\r\n                    const paramName = paramPart.slice(1);\r\n                    const paramValue = routeToMatchParts[i];\r\n                    params[paramName] = paramValue;\r\n\r\n                    // normalize the path to match\r\n                    routeToMatchParts[i] = paramPart;\r\n                }\r\n            }\r\n\r\n            // check if match\r\n            const normalizedPathToMatch = routeToMatchParts.join('/');\r\n            if (routePath === normalizedPathToMatch) {\r\n                return {\r\n                    route,\r\n                    params\r\n                };\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    private normalizePath(path: string): string {\r\n        path = (path || '');\r\n        path = removeStart(path, '#', '/');\r\n        path = removeEnd(path, '/');\r\n        return path;\r\n    }\r\n}","import * as React from 'react';\r\nimport { HashRouter, RouteInfo } from '../logic';\r\nimport { RouterContext } from './RouterContext';\r\n\r\nexport interface RouterViewProps {\r\n    routerRef?: (router: HashRouter) => void;\r\n}\r\n\r\nclass RouterViewState {\r\n    public currentRoute: RouteInfo = {\r\n        path: undefined,\r\n        params: undefined\r\n    };\r\n}\r\n\r\nexport class RouterView extends React.Component<RouterViewProps, RouterViewState> {\r\n\r\n    private router = new HashRouter();\r\n\r\n    constructor(props: RouterViewProps) {\r\n        super(props);\r\n        this.state = new RouterViewState();\r\n    }\r\n\r\n    public componentDidMount() {\r\n        this.router.listen();\r\n    }\r\n\r\n    public render() {\r\n\r\n        if (this.props.routerRef) {\r\n            this.props.routerRef(this.router);\r\n        }\r\n\r\n        return (\r\n            <RouterContext.Provider\r\n                value={{\r\n                    router: this.router,\r\n                    currentRoute: this.state.currentRoute,\r\n                    setCurrentRoute: this.setCurrentRoute\r\n                }}\r\n            >\r\n                {this.props.children}\r\n            </RouterContext.Provider>\r\n        );\r\n    }\r\n\r\n    private setCurrentRoute = (currentRoute: RouteInfo) => {\r\n        this.setState({ currentRoute });\r\n    };\r\n}"],"names":["removeStart","str","toRemove","removeSide","String","prototype","startsWith","s","tr","substring","length","removeEnd","endsWith","whitespaceReplacePattern","shouldRemove","remove","Error","every","replace","result","keepRunning","trimStr","call","WaitHandle","constructor","promise","Promise","resolve","reject","_resolve","_reject","wait","err","RouterContext","React","undefined","PromptNavigation","props","context","state","setState","isNavigating","enabled","children","router","onBeforeNavigation","confirmNavigation","confirmed","catch","exitPrompt","onBeforeUnload","clearState","confirm","cancel","Route","registerRoute","path","currentRoute","component","route","render","React.createElement","renderRoute","mapPath","params","setCurrentRoute","RouteFallback","fallback","HashRouter","location","hash","normalizePath","_currentRoute","matchResult","match","nextRoute","continueNavigation","prevRoute","goTo","action","_onBeforeNavigation","value","_onBeforeUnload","routes","goBack","window","history","back","listen","addEventListener","e","promptMessage","returnValue","handleHashChanged","pathToMatch","routePath","Object","keys","routeToMatchParts","split","search","routeParts","i","paramPart","paramName","slice","paramValue","normalizedPathToMatch","join","RouterViewState","RouterView","componentDidMount","routerRef"],"mappings":"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"}